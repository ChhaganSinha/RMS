@page "/"
@using RMS.Client.Client
@using RMS.Client.Shared.ChartJs
@using RMS.Dto.Dashboard
@inject AppClient client
@inject NavigationManager NavigationManager
@attribute [Authorize]


<div class="row">
    <div class="row">
        <div class="col-md-6 col-xl-3">
            <div class="card bg-c-blue order-card">
                <div class="card-body" style="padding: 4px 25px;">
                    <h6 class="text-white">Total Bookings</h6>
                    <h2 class="text-right text-white"><i class="feather icon-shopping-cart float-left"></i><span>@bookingStats?.TotalBookings</span></h2>
                    <p class="m-b-0">Today<span class="float-right">@bookingStats?.TodaysBookings</span></p>
                    <p class="m-b-0">This month<span class="float-right">@bookingStats?.ThisMonthBookings</span></p>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-xl-3">
        <div class="card bg-c-green order-card">
            <div class="card-body" style="padding: 4px 25px;">
                <h6 class="text-white">Total Amount</h6>
                <h2 class="text-right text-white"><i class="feather icon-tag float-left"></i><span>&#8377;0</span></h2>
                <p class="m-b-0">Today<span class="float-right">0</span></p>
                <p class="m-b-0">This Month<span class="float-right">0</span></p>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-xl-3">
        <div class="card bg-c-yellow order-card">
            <div class="card-body" style="padding: 4px 25px;">
                <h6 class="text-white">Total Customer</h6>
                <h2 class="text-right text-white"><i class="feather icon-repeat float-left"></i><span>0</span></h2>
                <p class="m-b-0">Today<span class="float-right">0</span></p>
                <p class="m-b-0">This Month<span class="float-right">0</span></p>
            </div>
        </div>
    </div>
    <div class="col-md-6 col-xl-3">
        <div class="card bg-c-red order-card">
            <div class="card-body" style="padding: 4px 25px;">
                <h6 class="text-white">Total Sales</h6>
                <h2 class="text-right text-white"><i class="feather icon-award float-left"></i> <span>&#8377;0</span></h2>
                <p class="m-b-0">Today<span class="float-right">0</span></p>
                <p class="m-b-0">This Month<span class="float-right">0</span></p>
            </div>
        </div>
    </div>
    @* dummy chart *@
    <div class="col-xl-12 col-md-12">
        <div class="card">
            <div class="card-header text-center">
                <h5>Month wise Customer Reservation</h5>
            </div>
            <div class="card-body">
                <div style="width: 100%;">
                    <Chart Id="TrainingBar" Type="@ChartType.bar" Datasets="@TrainingBarChartData" AspectRatio="false"
                           Labels="@TrainingBarChartLabels" Ids="@TrainingBarChartIds" IsStacked="false">
                    </Chart>
                </div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xl-6 col-md-6">
            <div class="card" style="height: 500px;">
                <div class="card-header" style="text-align:center">
                    <h5>Clicks % by Department </h5>
                </div>
                <div class="card-body" style="height: calc(100% - 56px);">
                    <Chart Id="TrainingPie" Type="@ChartType.pie" Datasets="@TrainingPieChartData" AspectRatio="false"
                           Labels="@TrainingPieChartLabels" Ids="@TrainingPieChartIds" IsStacked="false">
                    </Chart>
                </div>
            </div>
        </div>
        <div class="col-xl-6 col-md-6">
            <div class="card" style="height: 500px;">
                <div class="card-header text-center">
                    <h5>Trend of Customer Reservation</h5>
                </div>
                <div class="card-body" style="height: calc(100% - 56px);">
                    <div style="width: 100%;">
                        <Chart Id="TrainingLine" Type="@ChartType.line" Datasets="@TrainingLineChartData" AspectRatio="false"
                               Labels="@TrainingLineChartLabels" Ids="@TrainingLineChartIds" IsStacked="false">
                        </Chart>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-xl-6 col-md-6">
            <div class="card">
                <div class="card-header" style="text-align:center">
                    <h5>Today's Bookings</h5>
                </div>
                <div class="card-body" style="height: 300px; overflow: auto;">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Phone No.</th>
                                <th>Email</th>
                                <th>Address</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var booking in TodaysBookings)
                            {
                                <tr>
                                    <td>@booking.CustomerInfo.FirstOrDefault()?.Name</td>
                                    <td>@booking.CustomerInfo.FirstOrDefault()?.MobileNo</td>
                                    <td>@booking.CustomerInfo.FirstOrDefault()?.Email</td>
                                    <td>@booking.ArrivalFrom</td>
                                    
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-xl-6 col-md-6">
            <div class="card">
                <div class="card-header" style="text-align:center">
                    <h5>Next Day's Bookings</h5>
                </div>
                <div class="card-body" style="height: 300px; overflow: auto;">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Phone No.</th>
                                <th>Email</th>
                                <th>Address</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var booking in NextDaysBookings)
                            {
                                <tr>
                                    <td>@booking.CustomerInfo.FirstOrDefault()?.Name</td>
                                    <td>@booking.CustomerInfo.FirstOrDefault()?.MobileNo</td>
                                    <td>@booking.CustomerInfo.FirstOrDefault()?.Email</td>
                                    <td>@booking.ArrivalFrom</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private List<ChartJsDataset> TrainingBarChartData = new List<ChartJsDataset>
    {
        new ChartJsDataset
        {
            Label = "Booking",
            Data = new string[] { "50", "60", "70", "80", "90", "85", "95","75", "80", "90", "95", "70" },
            BackgroundColor = new string[] { "rgba(75, 192, 192, 0.2)" }
        }
    };

    private List<ChartJsDataset> TrainingLineChartData = new List<ChartJsDataset>
    {
        new ChartJsDataset
        {
            Label = "Completion Percentage",
            Data = new string[] { "50", "60", "70", "80", "90", "85", "95","75", "80", "90", "95", "70" },
            BackgroundColor = new string[] { "rgba(153, 102, 255, 0.2)" }
        }
    };

    private List<ChartJsDataset> TrainingPieChartData = new List<ChartJsDataset>
    {
        new ChartJsDataset
        {
            Label = "Percentage",
            Data = new string[] { "10", "20" },
            BackgroundColor = new string[] { "rgba(255, 99, 132, 0.2)", "rgba(54, 162, 235, 0.2)", "rgba(255, 206, 86, 0.2)", "rgba(75, 192, 192, 0.2)" }
        }
    };

    private string[] TrainingBarChartLabels = { "January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December" };
    private int[] TrainingBarChartIds = { 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12 };

    private string[] TrainingLineChartLabels = { "January", "February", "March", "April", "May", "June", "July" };
    private int[] TrainingLineChartIds = { 1, 2, 3, 4, 5, 6, 7 };

    private string[] TrainingPieChartLabels = { "Booking Amount", "Total Booking" };
    private int[] TrainingPieChartIds = { 1, 2 };



    private List<ReservationDetailsDto> TodaysBookings = new List<ReservationDetailsDto>();
    private List<ReservationDetailsDto> NextDaysBookings = new List<ReservationDetailsDto>();
    private Statistic bookingStats;

    protected override async Task OnInitializedAsync()
    {
        TodaysBookings = await client.GetTodaysBookingsAsync();
        NextDaysBookings = await client.GetNextDaysBookingsAsync();
        bookingStats = await client.GetBookingStatsAsync();
    }
}
